<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Email Sorter / Automator</title>
    <link rel="stylesheet" href="/static/css/main.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>ðŸ“§ Email Sorter / Automator</h1>
            <p>Organize and automate your email workflow</p>
        </header>

        <!-- Navigation Tabs -->
        <div class="nav-tabs">
            <button class="nav-tab" onclick="switchTab('dashboard', event)">Dashboard</button>
            <button class="nav-tab" onclick="switchTab('rules', event)">Email Rules</button>
            <button class="nav-tab" onclick="switchTab('templates', event)">Email Templates</button>
        </div>

        <!-- Dashboard Section -->
        <div id="dashboard-section" class="content-section">
            <div class="stats-grid">
                <div class="stat-card">
                    <h3 id="stat-total-rules">0</h3>
                    <p>Total Rules</p>
                </div>
                <div class="stat-card">
                    <h3 id="stat-active-rules">0</h3>
                    <p>Active Rules</p>
                </div>
                <div class="stat-card">
                    <h3 id="stat-inactive-rules">0</h3>
                    <p>Inactive Rules</p>
                </div>
                <div class="stat-card">
                    <h3 id="stat-total-templates">0</h3>
                    <p>Email Templates</p>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>Quick Actions</h2>
                </div>
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px;">
                    <button class="btn btn-primary" onclick="switchTab('rules'); RulesManager.showCreateModal();">
                        Create New Rule
                    </button>
                    <button class="btn btn-secondary" onclick="switchTab('templates'); TemplatesManager.showCreateModal();">
                        Create New Template
                    </button>
                    <button class="btn btn-success" onclick="switchTab('rules')">
                        Manage Rules
                    </button>
                    <button class="btn btn-info" onclick="switchTab('templates')">
                        Manage Templates
                    </button>
                </div>
            </div>

            <div class="card">
                <div class="card-header">
                    <h2>About</h2>
                </div>
                <p style="color: #666; line-height: 1.8;">
                    Email Sorter / Automator helps you organize and automate your email workflow. 
                    Create custom sorting rules based on conditions like sender, subject, keywords, and more. 
                    Manage email templates for automated responses and configure priority-based rule execution.
                </p>
            </div>
        </div>

        <!-- Rules Section -->
        <div id="rules-section" class="content-section">
            <div class="card">
                <div class="card-header">
                    <h2>Email Rules</h2>
                    <button class="btn btn-primary" onclick="RulesManager.showCreateModal()">
                        + Create Rule
                    </button>
                </div>

                <div class="search-bar">
                    <input type="text" id="rules-search" class="form-control" placeholder="Search rules by name, conditions, or actions...">
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Status</th>
                                <th>Conditions</th>
                                <th>Actions</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="rules-list">
                            <tr>
                                <td colspan="5" class="text-center" style="padding: 40px;">
                                    <div class="loading"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- Templates Section -->
        <div id="templates-section" class="content-section">
            <div class="card">
                <div class="card-header">
                    <h2>Email Templates</h2>
                    <button class="btn btn-primary" onclick="TemplatesManager.showCreateModal()">
                        + Create Template
                    </button>
                </div>

                <div class="search-bar">
                    <input type="text" id="templates-search" class="form-control" placeholder="Search templates by name, subject, or body...">
                </div>

                <div class="table-container">
                    <table>
                        <thead>
                            <tr>
                                <th>Name / Subject</th>
                                <th>Category</th>
                                <th>Body</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="templates-list">
                            <tr>
                                <td colspan="4" class="text-center" style="padding: 40px;">
                                    <div class="loading"></div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
    </div>

    <!-- Rule Modal -->
    <div id="rule-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 id="rule-modal-title">Create New Rule</h3>
                <button class="modal-close" onclick="RulesManager.hideModal()">Ã—</button>
            </div>
            <form id="rule-form">
                <div class="form-group">
                    <label for="rule-name">Rule Name *</label>
                    <input type="text" id="rule-name" name="name" class="form-control" required placeholder="e.g., Move urgent emails to folder">
                </div>
                
                <div class="form-group">
                    <label style="font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; display: block;">Conditions *</label>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border: 2px solid #e9ecef;">
                        <div class="form-group">
                            <label for="condition-sender">From Email (Optional)</label>
                            <input type="email" id="condition-sender" class="form-control" placeholder="example@email.com">
                            <small style="color: #718096; font-size: 0.875rem;">Leave empty to match any sender</small>
                        </div>
                        <div class="form-group">
                            <label for="condition-subject">Subject Contains (Optional)</label>
                            <input type="text" id="condition-subject" class="form-control" placeholder="urgent, important, etc.">
                            <small style="color: #718096; font-size: 0.875rem;">Match emails with this text in subject</small>
                        </div>
                        <div class="form-group">
                            <label for="condition-body">Body Contains (Optional)</label>
                            <input type="text" id="condition-body" class="form-control" placeholder="keyword or phrase">
                            <small style="color: #718096; font-size: 0.875rem;">Match emails with this text in body</small>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="condition-has-attachment" style="width: auto;">
                                <span>Has Attachment</span>
                            </label>
                        </div>
                    </div>
                </div>
                
                <div class="form-group">
                    <label style="font-size: 1.1rem; font-weight: 600; margin-bottom: 15px; display: block;">Actions *</label>
                    <div style="background: #f8f9fa; padding: 20px; border-radius: 8px; border: 2px solid #e9ecef;">
                        <div class="form-group">
                            <label for="action-folder">Move to Folder (Optional)</label>
                            <input type="text" id="action-folder" class="form-control" placeholder="e.g., Urgent, Important, Archive">
                            <small style="color: #718096; font-size: 0.875rem;">Folder name where emails will be moved</small>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="action-mark-read" style="width: auto;">
                                <span>Mark as Read</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                                <input type="checkbox" id="action-mark-important" style="width: auto;">
                                <span>Mark as Important</span>
                            </label>
                        </div>
                        <div class="form-group">
                            <label for="action-label">Add Label (Optional)</label>
                            <input type="text" id="action-label" class="form-control" placeholder="e.g., Work, Personal, Follow-up">
                            <small style="color: #718096; font-size: 0.875rem;">Label to add to matching emails</small>
                        </div>
                        <div class="form-group">
                            <label for="action-template">Auto-Reply Template (Optional)</label>
                            <select id="action-template" class="form-control">
                                <option value="">None</option>
                            </select>
                            <small style="color: #718096; font-size: 0.875rem;">Automatically reply with this template</small>
                        </div>
                    </div>
                </div>
                
                <div class="form-row">
                    <div class="form-group">
                        <label for="rule-priority">Priority</label>
                        <input type="number" id="rule-priority" name="priority" class="form-control" value="0" min="0" placeholder="0">
                        <small style="color: #718096; font-size: 0.875rem;">Higher numbers = higher priority</small>
                    </div>
                    <div class="form-group">
                        <label style="display: flex; align-items: center; gap: 10px; cursor: pointer;">
                            <input type="checkbox" id="rule-is-active" name="is_active" checked style="width: auto;">
                            <span>Active</span>
                        </label>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="RulesManager.hideModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Rule</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Template Modal -->
    <div id="template-modal" class="modal-overlay">
        <div class="modal">
            <div class="modal-header">
                <h3 id="template-modal-title">Create New Template</h3>
                <button class="modal-close" onclick="TemplatesManager.hideModal()">Ã—</button>
            </div>
            <form id="template-form">
                <div class="form-group">
                    <label for="template-name">Template Name *</label>
                    <input type="text" id="template-name" name="name" class="form-control" required placeholder="e.g., Out of Office Response">
                </div>
                <div class="form-group">
                    <label for="template-subject">Subject *</label>
                    <input type="text" id="template-subject" name="subject" class="form-control" required placeholder="e.g., Re: Your inquiry">
                </div>
                <div class="form-group">
                    <label for="template-category">Category</label>
                    <input type="text" id="template-category" name="category" class="form-control" value="general" placeholder="e.g., general, support, sales">
                </div>
                <div class="form-group">
                    <label for="template-body">Body *</label>
                    <textarea id="template-body" name="body" class="form-control" rows="10" required placeholder="Enter your email template body here..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="button" class="btn btn-secondary" onclick="TemplatesManager.hideModal()">Cancel</button>
                    <button type="submit" class="btn btn-primary">Save Template</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/static/js/main.js"></script>
</body>
</html>
